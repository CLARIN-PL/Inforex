/**
*    Modified by Wojciech Gawe≈Ç 2011-2013
*    - add "punbb" style
*    - add history in url (need "jQuery BBQ: Back Button & Query Library")
**/
(function(e){e.extend({tablesorterPager:new function(){function t(t){var n;if(t.view==="punbb"){var r="";var i=t.page+1;var s=t.totalPages;var o=t.viewPunbbVisiblePageNumberMargin;var u=t.viewPunbbVisiblePageNumberMarginAtCorners;for(var a=1;a<=t.totalPages;a++){var f=a===t.totalPages;var l=a===1;if(a>u&&i-a>o&&!(o+u-i+2===0)){if(i-a===o+u){r+="..."}}else if(a<=s-u&&a-i>o&&!(t.totalPages-o-u-i-1===0)){if(a-i===o+u){r+="..."}}else{if(i===a){r+='<a href="#'+t.currentPageUrlId+"="+a+'" class="'+t.currentPageNumber+(f?" last":l?" first":"")+'" id="'+a+'">'+a+"</a>"}else{r+='<a href="#'+t.currentPageUrlId+"="+a+'" id="'+a+'" class="'+(f?" last":l?" first":"")+'">'+a+"</a>"}}}n=e(t.cssPageDisplay,t.container).html(r)}else{n=e(t.cssPageDisplay,t.container).val(t.page+1+t.seperator+t.totalPages)}}function n(e,t){var n=e.config;n.size=t;n.totalPages=Math.ceil(n.totalRows/n.size);n.pagerPositionSet=false;a(e);r(e)}function r(t){var n=t.config;if(!n.pagerPositionSet&&n.positionFixed){var n=t.config,r=e(t);if(r.offset){n.container.css({top:r.offset().top+r.height()+"px",position:"absolute"})}n.pagerPositionSet=true}}function i(e){var t=e.config;t.page=0;a(e)}function s(e){var t=e.config;t.page=t.totalPages-1;a(e)}function o(e){var t=e.config;t.page++;if(t.page>=t.totalPages-1){t.page=t.totalPages-1}a(e)}function u(e){var t=e.config;t.page--;if(t.page<=0){t.page=0}a(e)}function a(t){var n=t.config;if(n.page<0||n.page>n.totalPages-1){n.page=0}var r={};r[t.config.currentPageUrlId]=n.page+1;e.bbq.pushState(r);f(t,n.rowsCopy)}function f(n,i){var o=n.config;var u=i.length;var a=o.page*o.size;var f=a+o.size;if(f>i.length){f=i.length}var l=e(n.tBodies[0]);e.tablesorter.clearTableBody(n);for(var c=a;c<f;c++){var h=i[c];var u=h.length;for(var p=0;p<u;p++){l[0].appendChild(h[p])}}r(n,l);e(n).trigger("applyWidgets");if(o.page>=o.totalPages){s(n)}t(o)}this.appender=function(e,t){var n=e.config;n.rowsCopy=t;n.totalRows=t.length;n.totalPages=Math.ceil(n.totalRows/n.size);f(e,t)};this.defaults={size:10,offset:0,page:0,totalRows:0,totalPages:0,container:null,cssNext:".next",cssPrev:".prev",cssFirst:".first",cssLast:".last",cssPageDisplay:".pagedisplay",cssPageSize:".pagesize",seperator:"/",positionFixed:true,appender:this.appender,view:"standard",viewPunbbVisiblePageNumberMargin:2,viewPunbbVisiblePageNumberMarginAtCorners:2,currentPageNumber:"currentPageNumber",currentPageUrlId:"page"};this.construct=function(t){return this.each(function(){config=e.extend(this.config,e.tablesorterPager.defaults,t);var r=this,f=config.container;e(this).trigger("appendCache");config.size=parseInt(e(".pagesize",f).val());e(config.cssFirst,f).click(function(){i(r);return false});e(config.cssNext,f).click(function(){o(r);return false});e(config.cssPrev,f).click(function(){u(r);return false});e(config.cssLast,f).click(function(){s(r);return false});e(config.cssPageSize,f).change(function(){n(r,parseInt(e(this).val()));return false});e(config.cssPageDisplay,f).delegate("a","click",function(){r.config.page=parseInt(e(this).attr("id"))-1;a(r);return false});e(window).bind("hashchange",function(t){if(r.config!==undefined){var n=e.bbq.getState(r.config.currentPageUrlId,true)||1;if(r.config.page!=n-1){r.config.page=n-1;a(r)}}});e(window).trigger("hashchange")})}}});e.fn.extend({tablesorterPager:e.tablesorterPager.construct})})(jQuery)
